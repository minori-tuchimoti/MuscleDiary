<body style="background-image: url('<%= asset_path('sport-908264_640.jpg') %>'); background-repeat: no-repeat; background-position: center center; background-size: cover; background-color: rgba(255, 255, 255, 0.5);">
  <% if flash[:alert].present? %>
    <div class="alert alert-danger">
      <%= flash[:alert] %>
    </div>
  <% end %>

  <div class="container mt-4" style="background-color: rgba(255, 255, 255, 0.7); padding: 20px; border-radius: 10px;">
    <div class="row">
      <!-- „Çµ„Ç§„Éâ„Éê„ÉºÈÉ®ÂàÜ -->
      <div class="col-md-3 mt-4">
        <%= render 'public/searches/search', users: @users, muscles: @muscles, range: @range %>
        <%= render 'public/muscles/muscle', muscles: @muscles, user: @user %>
      </div>

      <!-- ÊäïÁ®øÈÉ®ÂàÜ -->
      <div class="col-md-8 offset-md-1 mt-4">
        <h1>Posts</h1>

        <div class="row">
          <% @muscles.each do |muscle| %>
              <div class="col-12 mb-4">
                <div class="card shadow-sm border-0 p-3" style="border-radius: 16px; background-color: #fefefe; width: 100%;">

                  <!-- „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„Ç®„É™„Ç¢ -->
                  <div class="d-flex align-items-center">
                    <!-- „Éó„É≠„Éï„Ç£„Éº„É´ÁîªÂÉè -->
                    <div class="me-3">
                      <%= link_to user_path(muscle.user) do %>
                        <%= image_tag muscle.user.get_profile_image(100, 100), class: 'rounded-circle border border-2', style: 'object-fit: cover;' %>
                      <% end %>
                    </div>

                  <!-- „É¶„Éº„Ç∂„ÉºÂêç -->
                  <div class="flex-grow-1">
                    <div class="mb-1">
                      <small class="text-secondary">üë§ „É¶„Éº„Ç∂„ÉºÂêç</small><br>
                      <%= link_to muscle.user.name, user_path(muscle.user), class: 'fw-bold text-primary text-decoration-none fs-5' %>
                      </div>
                    </div>
                  </div>

                  <!-- ÊäïÁ®øÂÜÖÂÆπ„Ç®„É™„Ç¢ -->
                  <div class="mt-3">
                    <!-- ÊäïÁ®ø„Çø„Ç§„Éà„É´ -->
                    <div class="mb-1">
                      <small class="text-secondary">üìù „Çø„Ç§„Éà„É´</small><br>
                      <%= link_to muscle.title, muscle_path(muscle), class: 'text-primary text-decoration-none' %>
                    </div>

                    <!-- ÊäïÁ®øÊú¨Êñá -->
                    <div class="mb-2 text-muted">
                      <small class="text-secondary">üìÑ ÊäïÁ®ø</small><br>
                      <%= truncate(muscle.body, length: 80) %>
                    </div>

                    <!-- Ê∑ª‰ªòÁîªÂÉè„ÅÆË°®Á§∫ -->
                    <% if muscle.images.attached? %>
                      <div class="mb-3">
                          <small class="text-secondary d-block mb-2">üñºÔ∏è ÁîªÂÉè</small>
                        <div class="text-center">
                          <% muscle.images.each do |file| %>
                            <% if file.content_type.start_with?('image') %>
                              <%= image_tag file.variant(resize_to_limit: [200, 200]),
                                class: "img-thumbnail mx-auto d-block mb-2",
                                style: "max-height: 150px; cursor: pointer;",
                                data: { bs_toggle: "modal", bs_target: "#mediaModal", media_type: "image", src: url_for(file) } %>
                              <% end %>
                            <% end %>
                        </div>
                      </div>
                    <% end %>

                    <!-- Ê∑ª‰ªòÂãïÁîª„ÅÆË°®Á§∫ -->
                    <% if muscle.videos.attached? %>
                      <div class="mb-3">
                          <small class="text-secondary d-block mb-2">üé• ÂãïÁîª</small>
                        <div class="text-center">
                          <% muscle.videos.each do |video| %>
                            <video width="200" class="rounded mx-auto d-block mb-2"
                              style="max-height: 150px; cursor: pointer;"
                              data-bs-toggle="modal" data-bs-target="#mediaModal"
                              data-media-type="video" data-src="<%= url_for(video) %>" data-content-type="<%= video.content_type %>">
                              <source src="<%= url_for(video) %>" type="<%= video.content_type %>">
                            </video>
                          <% end %>
                        </div>
                      </div>
                    <% end %>


                    <!-- ÊäïÁ®øÊó•ÊôÇ -->
                    <div class="mb-2 text-muted">
                      <small class="text-secondary">üìÖ ÊäïÁ®øÊó•</small><br>
                      <%= muscle.created_at.strftime("%YÂπ¥%mÊúà%dÊó• %H:%M") %>
                    </div>

                  </div>
                </div>
              </div>
          <% end %>
        </div>

        <div class="d-flex justify-content-center mt-4">
          <%= paginate @muscles %>
        </div>
        
      </div>
    </div>
  </div>

  <!-- „É¢„Éº„ÉÄ„É´ÂÆöÁæ© -->
  <div class="modal fade" id="mediaModal" tabindex="-1" aria-labelledby="mediaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md"><!-- modal-lg ‚Üí modal-md „Å´Â§âÊõ¥ -->
      <div class="modal-content bg-transparent border-0">
        <!-- √ó„Éú„Çø„É≥ -->
        <div class="d-flex justify-content-end pe-2 pt-2">
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body text-center p-0">
          <img id="modalImage" src="" class="img-fluid rounded d-none" />
          <video id="modalVideo" controls class="rounded d-none" style="max-width: 500px; width: 90vw; max-height: 400px;">
            <source id="modalVideoSource" src="" type="">
            Your browser does not support the video tag.
          </video>
        </div>
      </div>
    </div>
  </div>


  <%= javascript_tag do %>
    document.addEventListener('DOMContentLoaded', function () {
      const modal = document.getElementById('mediaModal');
      const modalImage = document.getElementById('modalImage');
      const modalVideo = document.getElementById('modalVideo');
      const modalVideoSource = document.getElementById('modalVideoSource');

      modal.addEventListener('show.bs.modal', function (event) {
        const trigger = event.relatedTarget;
        const mediaType = trigger.getAttribute('data-media-type');
        const src = trigger.getAttribute('data-src');

        modalImage.classList.add('d-none');
        modalVideo.classList.add('d-none');

        if (mediaType === 'image') {
          modalImage.src = src;
          modalImage.classList.remove('d-none');
        } else if (mediaType === 'video') {
          const contentType = trigger.getAttribute('data-content-type');
          modalVideoSource.src = src;
          modalVideoSource.type = contentType;
          modalVideo.load();
          modalVideo.classList.remove('d-none');
        }
      });

      // „É¢„Éº„ÉÄ„É´Èñâ„Åò„ÅüÊôÇ„Å´ÂãïÁîª„ÇíÂÅúÊ≠¢ÔºÜ„ÇΩ„Éº„Çπ„ÇØ„É™„Ç¢
      modal.addEventListener('hide.bs.modal', function () {
        modalVideo.pause();
        modalVideoSource.src = '';
        modalVideo.load();
      });
    });
  <% end %>


</body>
