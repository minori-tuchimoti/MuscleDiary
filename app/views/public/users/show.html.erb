<body style="background-image: url('<%= asset_path('sport-908264_640.jpg') %>'); background-repeat: no-repeat; background-position: center center; background-size: cover; background-color: rgba(255,255,255,0.5);">
  
  <% if flash[:notice].present? %>
    <div class="alert alert-success bg-white">
      <%= flash[:notice] %>
    </div>
  <% end %>

  <div class="container mt-4" style="background-color: rgba(255,255,255,0.7); padding: 20px; border-radius: 10px;">
    <div class="row">
      
      <!-- „Çµ„Ç§„Éâ„Éê„Éº (Ê§úÁ¥¢ÈÉ®ÂàÜ„ÄÅ„É¶„Éº„Ç∂„Éº„Éó„É≠„Éï„ÄÅÊñ∞Ë¶èÊäïÁ®ø) -->
      <div class="col-md-3 mt-4">
        <%= render 'public/searches/search', users: @users, muscles: @muscles, range: @range %>
        <%= render 'public/muscles/muscle', muscles: @muscle, user: @user %>
      </div>

      <!-- ÊäïÁ®øÈÉ®ÂàÜ -->
      <div class="col-md-8 offset-md-1 mt-4">
        <h1>User Posts</h1>

        <div class="row">
          <% @muscles.each do |muscle| %>
            <div class="col-12 mb-4">
              <div class="card shadow-sm border-0 p-3 d-flex flex-row align-items-center" style="border-radius: 16px; background-color: #fefefe;">
                
                <!-- „Éó„É≠„Éï„Ç£„Éº„É´ÁîªÂÉè -->
                <div class="flex-shrink-0 me-4">
                  <%= link_to user_path(muscle.user) do %>
                    <%= image_tag muscle.user.get_profile_image(80, 80), class: 'rounded-circle border border-2', style: 'object-fit: cover;' %>
                  <% end %>
                </div>

                <!-- ÊäïÁ®øÂÜÖÂÆπ -->
                <div class="flex-grow-1">
                  
                  <!-- „É¶„Éº„Ç∂„ÉºÂêç -->
                  <div class="mb-2">
                    <small class="text-secondary fw-semibold">üë§ „É¶„Éº„Ç∂„ÉºÂêç</small><br>
                    <%= link_to muscle.user.name, user_path(muscle.user), class: 'fw-bold text-dark text-decoration-none fs-5' %>
                  </div>

                  <!-- „Çø„Ç§„Éà„É´ -->
                  <div class="mb-2">
                    <small class="text-secondary fw-semibold">üìù „Çø„Ç§„Éà„É´</small><br>
                    <%= link_to muscle.title, muscle_path(muscle), class: 'text-primary fs-5 text-decoration-none' %>
                  </div>

                  <!-- ÊäïÁ®øÂÜÖÂÆπ -->
                  <div class="mb-3">
                    <small class="text-secondary fw-semibold">üìÑ ÊäïÁ®ø</small>
                    <p class="text-muted mt-1 mb-0"><%= truncate(muscle.body, length: 100) %></p>
                  </div>

                <!-- ÁîªÂÉèË°®Á§∫ -->
                <% if muscle.images.attached? %>
                  <div class="mb-3">

                    <!-- „É©„Éô„É´„ÅØÂ∑¶ÂØÑ„Åõ -->
                    <small class="text-secondary d-block mb-2">üñºÔ∏è ÁîªÂÉè</small>

                    <!-- ÁîªÂÉè„ÅØ‰∏≠Â§ÆÂØÑ„Åõ -->
                    <div class="text-center">
                      <% muscle.images.each do |file| %>
                        <% if file.content_type.start_with?('image') %>
                          <%= image_tag file.variant(resize_to_limit: [200, 200]),
                          class: "img-thumbnail",
                          style: "cursor: pointer;",
                          data: {
                            bs_toggle: "modal",
                            bs_target: "#mediaModal",
                            media_type: "image",
                            src: url_for(file)
                          } %>
                        <% end %>
                      <% end %>
                    </div>
                  </div>
                <% end %>

                <!-- ÂãïÁîªË°®Á§∫ -->
                <% if muscle.videos.attached? %>
                  <div class="mb-3">

                    <!-- „É©„Éô„É´„ÅØÂ∑¶ÂØÑ„Åõ -->
                    <small class="text-secondary d-block mb-2">üé• ÂãïÁîª</small>

                    <!-- ÂãïÁîª„ÅØ‰∏≠Â§ÆÂØÑ„Åõ -->
                    <div class="text-center">
                      <% muscle.videos.each do |video| %>
                        <video class="rounded"
                        style="max-height: 150px; cursor: pointer;"
                        data-bs-toggle="modal"
                        data-bs-target="#mediaModal"
                        data-media-type="video"
                        data-src="<%= url_for(video) %>"
                        data-content-type="<%= video.content_type %>">
                          <source src="<%= url_for(video) %>" type="<%= video.content_type %>">
                        </video>
                      <% end %>
                    </div>
                  </div>
                <% end %>



                  <!-- ÊäïÁ®øÊó•ÊôÇ -->
                  <div class="mb-2 text-muted">
                    <small class="text-secondary">üìÖ ÊäïÁ®øÊó•</small><br>
                    <%= muscle.created_at.strftime("%YÂπ¥%mÊúà%dÊó• %H:%M") %>
                  </div>

                  <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
                  <% if current_user == muscle.user %>
                    <div class="d-flex gap-2 mt-2">
                      <%= link_to 'Á∑®ÈõÜ', edit_muscle_path(muscle), class: 'btn btn-outline-primary btn-sm px-3 rounded-pill' %>
                      <%= button_to 'ÂâäÈô§', muscle, method: :delete, data: { confirm: 'Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü' }, class: 'btn btn-outline-danger btn-sm px-3 rounded-pill' %>
                    </div>
                  <% end %>

                </div>
              </div>
            </div>
          <% end %>
        </div>

      <div class="d-flex justify-content-center mt-4">
        <%= paginate @muscles %>
      </div>

      </div>
    </div>
  </div>

  <!-- „É¢„Éº„ÉÄ„É´ÂÆöÁæ© -->
<div class="modal fade" id="mediaModal" tabindex="-1" aria-labelledby="mediaModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-md">
    <div class="modal-content bg-transparent border-0">
      <div class="d-flex justify-content-end pe-2 pt-2">
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body text-center p-0">
        <img id="modalImage" src="" class="img-fluid rounded d-none" />
        <video id="modalVideo" controls class="rounded d-none" style="max-width: 500px; width: 90vw; max-height: 400px;">
          <source id="modalVideoSource" src="" type="">
          Your browser does not support the video tag.
        </video>
      </div>
    </div>
  </div>
</div>

<%= javascript_tag do %>
  document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('mediaModal');
    const modalImage = document.getElementById('modalImage');
    const modalVideo = document.getElementById('modalVideo');
    const modalVideoSource = document.getElementById('modalVideoSource');

    modal.addEventListener('show.bs.modal', function (event) {
      const trigger = event.relatedTarget;
      const mediaType = trigger.getAttribute('data-media-type');
      const src = trigger.getAttribute('data-src');

      modalImage.classList.add('d-none');
      modalVideo.classList.add('d-none');

      if (mediaType === 'image') {
        modalImage.src = src;
        modalImage.classList.remove('d-none');
      } else if (mediaType === 'video') {
        const contentType = trigger.getAttribute('data-content-type');
        modalVideoSource.src = src;
        modalVideoSource.type = contentType;
        modalVideo.load();
        modalVideo.classList.remove('d-none');
      }
    });

    modal.addEventListener('hide.bs.modal', function () {
      modalVideo.pause();
      modalVideoSource.src = '';
      modalVideo.load();
    });
  });
<% end %>

</body>
